Bug 162157 Exception when extract data from inside nest query with filter
Description: Exception when extract data from inside nest query with filter.
Steps to reproduce: filterExpression = new IFilterDefinition[1]; filterExpression[0] = new FilterDefinition( new ConditionalExpression( "row[""number""]", ConditionalExpression.OP_EQ, "112", null ) ); extractTask.setFilters( filterExpression ); result = extractTask.extract( ); if ( result != null ) { int num = 0; IDataIterator data = result.nextResultIterator( ); if ( data != null ) { data.next( ); num = Integer.parseInt( data .getValue( "number" ) .toString( ) ); assertEquals( 112, num ); } data.close( ); } Detail case in DataExtractionTaskTest.testDataExtractionFromIID_nestquery() in org.eclipse.birt.report.tests.engine.api package.
Expected result: Data are extracted correctly.
Actual result: Exception throws.
Error logs: org.eclipse.birt.core.exception.CoreException: Error evaluating Javascript expression.
Script engine error: ReferenceError: "dataSetRow" is not defined.
Script source: source, line: 0, text: dataSetRow["CUSTOMERNUMBER"] at org.eclipse.birt.core.script.JavascriptEvalUtil.wrapRhinoException(JavascriptEvalUtil.java:281) at org.eclipse.birt.core.script.JavascriptEvalUtil.evaluateRawScript(JavascriptEvalUtil.java:105) at org.eclipse.birt.data.engine.expression.ExprEvaluateUtil.doEvaluateRawExpression(ExprEvaluateUtil.java:229) at org.eclipse.birt.data.engine.expression.ExprEvaluateUtil.evaluateRawExpression(ExprEvaluateUtil.java:194) at org.eclipse.birt.data.engine.impl.PreparedDummyQuery$ResultIterator.getValue(PreparedDummyQuery.java:538) at org.eclipse.birt.report.engine.api.impl.DataIterator.getValue(DataIterator.java:49) at org.eclipse.birt.report.tests.engine.api.DataExtractionTaskTest.testDataExtractionFromIID_nestquery(DataExtractionTaskTest.java:456) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39) at sun.reflect.DelegatingMethodAccessorI
mpl.invoke(DelegatingMethodAccessorImpl.java:25) at java.lang.reflect.Method.invoke(Method.java:324) at junit.framework.TestCase.runTest(TestCase.java:154) at junit.framework.TestCase.runBare(TestCase.java:127) at junit.framework.TestResult$1.protect(TestResult.java:106) at junit.framework.TestResult.runProtected(TestResult.java:124) at junit.framework.TestResult.run(TestResult.java:109) at junit.framework.TestCase.run(TestCase.java:118) at org.eclipse.jdt.internal.junit.runner.junit3.JUnit3TestReference.run(JUnit3TestReference.java:128) at org.eclipse.jdt.internal.junit.runner.TestExecution.run(TestExecution.java:38) at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:460) at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:673) at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.run(RemoteTestRunner.java:386) at org.eclipse.pde.internal.junit.runtime.RemotePluginTestRunner.main(RemotePluginTestRunner.java
:58) at org.eclipse.pde.internal.