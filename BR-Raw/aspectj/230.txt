Java 1.2 dependency in aspectjrt.jar bug with fix
The thisJoinPoint.printString() fails on a 1.1 VM because it relies on a java.lang.ref.SoftReference. I need this to work because we're using AspectJ on an embedded device that is still using a pre-1.2 VM.
The problem lies in org.aspectj.runtime.reflect.SignatureImpl. The attached patch fixes it and passes all the tests. I tested the failing program manually on a 1.1 VM, but automating the test would require adding a 1.1 VM to the regression test infrastructure.
Sample:
public aspect Java11Test {
before() : execution(* *(..)) {
System.out.println(thisJoinPoint.toString());
}
public static void main(String args[]) {}
}
>ajc -target 1.1 Java11Test.aj
>javajre1.1.8_010binjre -cp .;%CLASSPATH% Java11Test
Exception in thread "main" java.lang.NoClassDefFoundError: java/lang/ref/SoftRef
erence
at org.aspectj.runtime.reflect.JoinPointImpl$StaticPartImpl.toString(Joi
nPointImpl.java:43)
at org.aspectj.runtime.reflect.JoinPointImpl$StaticPartImpl.toString(Joi
nPointImpl.java:48)
at Java11Test.ajc$before$Java11Test$1$3444dde4(Java11Test.aj:3)
at Java11Test.main(Java11Test.aj)