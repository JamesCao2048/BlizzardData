[@AspectJ]Lacking import for JoinPoint crahes the compiler
Encountered during a JavaPolis demo. I was using a pre-release
development version. However, reproducable with latest post-release
development version as well.
Create the following source file:
package banking;
import org.aspectj.lang.annotation.Aspect;
import org.aspectj.lang.annotation.Pointcut;
public class Main {
public static void main(String[] args) {
System.out.println("Main");
}
}
@Aspect
class MainLogger {
@Pointcut("execution(* main(..))")
public void log(JoinPoint thisJoinPoint) {
System.out.println("Before " thisJoinPoint");
}
}
Note that the import statement for JoinPoint is lacking. Compiling this
source file crahses the compiler. Adding import statement for JoinPoint
makes it work fine.
C:workaopsrcworkspaceCallDebugBug>ajc -version
AspectJ Compiler DEVELOPMENT built on Tuesday Dec 20, 2005 at 13:58:29 GMT
C:workaopsrcworkspaceCallDebugBug>ajc -1.5 bankingMain.java
C:workaopsrcworkspaceCallDebugBugbankingMain.java [error] Internal compil
er error
java.lang.NullPointerException
at org.aspectj.ajdt.internal.compiler.ast.ValidateAtAspectJAnnotationsVi
sitor.buildFormalAdviceBindingsFrom(ValidateAtAspectJAnnotationsVisitor.java:417
)
at org.aspectj.ajdt.internal.compiler.ast.ValidateAtAspectJAnnotationsVi
sitor.convertToPointcutDeclaration(ValidateAtAspectJAnnotationsVisitor.java:513)
at org.aspectj.ajdt.internal.compiler.ast.ValidateAtAspectJAnnotationsVi
sitor.visit(ValidateAtAspectJAnnotationsVisitor.java:188)
at org.aspectj.org.eclipse.jdt.internal.compiler.ast.MethodDeclaration.t
raverse(MethodDeclaration.java:185)
at org.aspectj.org.eclipse.jdt.internal.compiler.ast.TypeDeclaration.tra
verse(TypeDeclaration.java:1195)
at org.aspectj.org.eclipse.jdt.internal.compiler.ast.CompilationUnitDecl
aration.traverse(CompilationUnitDeclaration.java:339)
at org.aspectj.ajdt.internal.compiler.AjCompilerAdapter.beforeAnalysing(
AjCompilerAdapter.java:154)
at org.aspectj.ajdt.internal.compiler.CompilerAdapter.ajc$before$org_asp
ectj_ajdt_internal_compiler_CompilerAdapter$7$db78446d(CompilerAdapter.aj:101)
at org.aspectj.org.eclipse.jdt.internal.compiler.Compiler.process(Compil
er.java:517)
at org.aspectj.org.eclipse.jdt.internal.compiler.Compiler.compile(Compil
er.java:329)
at org.aspectj.ajdt.internal.core.builder.AjBuildManager.performCompilat
ion(AjBuildManager.java:811)
at org.aspectj.ajdt.internal.core.builder.AjBuildManager.doBuild(AjBuild
Manager.java:230)
at org.aspectj.ajdt.internal.core.builder.AjBuildManager.batchBuild(AjBu
ildManager.java:156)
at org.aspectj.ajdt.ajc.AjdtCommand.doCommand(AjdtCommand.java:112)
at org.aspectj.ajdt.ajc.AjdtCommand.runCommand(AjdtCommand.java:60)
at org.aspectj.tools.ajc.Main.run(Main.java:326)
at org.aspectj.tools.ajc.Main.runMain(Main.java:240)
at org.aspectj.tools.ajc.Main.main(Main.java:83)
(no source information available)
C:workaopsrcworkspaceCallDebugBugbankingMain.java:16 [error] JoinPoint ca
nnot be resolved to a type
public void log(JoinPoint thisJoinPoint) {
^^^^^^^
C:workaopsrcworkspaceCallDebugBugbankingMain.java:17 [error] Syntax error
, insert ")" to complete MethodInvocation
System.out.println("Before " thisJoinPoint");
C:workaopsrcworkspaceCallDebugBugbankingMain.java:17 [error] Syntax error
, insert ";" to complete BlockStatements
System.out.println("Before " thisJoinPoint");
ABORT
Exception thrown from AspectJ DEVELOPMENT
This might be logged as a bug already -- find current bugs at
http://bugs.eclipse.org/bugs/buglist.cgi?product=AspectJ&component=Compiler
Bugs for exceptions thrown have titles File:line from the top stack,
e.g., "SomeFile.java:243"
If you don't find the exception below in a bug, please add a new bug
at  http://bugs.eclipse.org/bugs/enter_bug.cgi?product=AspectJ
To make the bug a priority, please include a test program
that can reproduce this exception.
when validating @AspectJ annotations log
when analysing types defined in compilation unit C:workaopsrcworkspaceCallD
ebugBugbankingMain.java
when processing compilation unit C:workaopsrcworkspaceCallDebugBugbanking
Main.java
when batch building with classpath: c:javajdk1.5.0_04jrelibextdnsns.jar;c:
javajdk1.5.0_04jrelibextlocaledata.jar;c:javajdk1.5.0_04jrelibextsun
jce_provider.jar;c:javajdk1.5.0_04jrelibextsunpkcs11.jar;c:javajdk1.5.0_
04libtools.jar;c:javajdk1.5.0_04jrelibrt.jar;C:javaaspectjaspectj5lib
aspectjrt.jar;C:javalog4jjakarta-log4j-1.2.8distliblog4j-1.2.8.jar;C:jav
ajessJess61p5jess.jar;c:javaj2sdkee1.3.1libsystemcloudscape.jar;c:java
j2sdkee1.3.1libsystemtools.jar;c:javaj2sdkee1.3.1libcloudscapeRmiJdbc.ja
r;c:javaj2sdkee1.3.1libcloudscapecloudclient.jar;c:javaj2sdkee1.3.1libc
lasses;c:javaj2sdkee1.3.1classes;c:javaj2sdkee1.3.1libj2ee.jar;c:javaj2
sdkee1.3.1libtoolclasses;c:javaj2sdkee1.3.1libj2eetools.jar;c:javaj2sdke
e1.3.1liblocale;c:javaj2sdkee1.3.1libj2ee.jar;c:javaj2sdkee1.3.1libjha
ll.jar;c:javaj2sdkee1.3.1liblocale;c:javajdk1.5.0_04libtools.jar;c:java
j2sdkee1.3.1libjhall.jar;C:javawsaxisaxis-1_1libaxis.jar;C:javawsaxi
saxis-1_1libaxis-ant.jar;C:javawsaxisaxis-1_1libcommons-discovery.jar;C
:javawsaxisaxis-1_1libcommons-logging.jar;C:javawsaxisaxis-1_1libjax
rpc.jar;C:javawsaxisaxis-1_1libsaaj.jar;C:javawsaxisaxis-1_1liblog4j
-1.2.8.jar;C:javawsaxisaxis-1_1libwsdl4j.jar;C:javaconcurrencyconcurren
cy.jar;C:javajunitjunit3.8.1junit.jar;.;
null
java.lang.NullPointerException
at org.aspectj.ajdt.internal.compiler.ast.ValidateAtAspectJAnnotationsVi
sitor.buildFormalAdviceBindingsFrom(ValidateAtAspectJAnnotationsVisitor.java:417
)
at org.aspectj.ajdt.internal.compiler.ast.ValidateAtAspectJAnnotationsVi
sitor.convertToPointcutDeclaration(ValidateAtAspectJAnnotationsVisitor.java:513)
at org.aspectj.ajdt.internal.compiler.ast.ValidateAtAspectJAnnotationsVi
sitor.visit(ValidateAtAspectJAnnotationsVisitor.java:188)
at org.aspectj.org.eclipse.jdt.internal.compiler.ast.MethodDeclaration.t
raverse(MethodDeclaration.java:185)
at org.aspectj.org.eclipse.jdt.internal.compiler.ast.TypeDeclaration.tra
verse(TypeDeclaration.java:1195)
at org.aspectj.org.eclipse.jdt.internal.compiler.ast.CompilationUnitDecl
aration.traverse(CompilationUnitDeclaration.java:339)
at org.aspectj.ajdt.internal.compiler.AjCompilerAdapter.beforeAnalysing(
AjCompilerAdapter.java:154)
at org.aspectj.ajdt.internal.compiler.CompilerAdapter.ajc$before$org_asp
ectj_ajdt_internal_compiler_CompilerAdapter$7$db78446d(CompilerAdapter.aj:101)
at org.aspectj.org.eclipse.jdt.internal.compiler.Compiler.process(Compil
er.java:517)
at org.aspectj.org.eclipse.jdt.internal.compiler.Compiler.compile(Compil
er.java:329)
at org.aspectj.ajdt.internal.core.builder.AjBuildManager.performCompilat
ion(AjBuildManager.java:811)
at org.aspectj.ajdt.internal.core.builder.AjBuildManager.doBuild(AjBuild
Manager.java:230)
at org.aspectj.ajdt.internal.core.builder.AjBuildManager.batchBuild(AjBu
ildManager.java:156)
at org.aspectj.ajdt.ajc.AjdtCommand.doCommand(AjdtCommand.java:112)
at org.aspectj.ajdt.ajc.AjdtCommand.runCommand(AjdtCommand.java:60)
at org.aspectj.tools.ajc.Main.run(Main.java:326)
at org.aspectj.tools.ajc.Main.runMain(Main.java:240)
at org.aspectj.tools.ajc.Main.main(Main.java:83)
1 fail|abort, 4 errors