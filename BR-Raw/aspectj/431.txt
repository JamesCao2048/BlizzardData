pertypewithin() handing of inner classes
It seems that pertypewithin() aspect association does not handle nested classes
correctly. Here is a test class that exhibits the problem:
package test;
public class Test {
public static void main(String[] args) {
new NestedTest().run();
}

static class NestedTest implements Runnable {
public void run() {
System.out.println("Running...");
}
}
}

aspect PertypewithinTest pertypewithin(Test) {
before() : execution(* *.*(..)) {
System.out.println(thisJoinPointStaticPart);
}
}
> ajc -version
AspectJ Compiler DEVELOPMENT built on Monday Jan 24, 2005 at 17:07:00 GMT
> ajc testTest.java
> java test.Test
execution(void test.Test.main(String[]))
execution(void test.Test.bar())
Exception in thread "main" java.lang.NoSuchMethodError: test.Test$1.ajc$test_Per
typewithinTest$localAspectOf()Ltest/PertypewithinTest;
at test.Test$1.run(Test.java)
at test.Test.bar(Test.java:9)
at test.Test.main(Test.java:13)
The same problem is seen for anonymous inner classes, as well:
package test;
public class Test {
public void bar() {
new Runnable() {
public void run() {
System.out.println("Running...");
}
}.run();
}

public static void main(String[] args) {
new Test().bar();
}
}

aspect PertypewithinTest pertypewithin(Test) {
before() : execution(* *.*(..)) {
System.out.println(thisJoinPoint);
}
}
> ajc testTest.java
> java test.Test
execution(void test.Test.main(String[]))
execution(void test.Test.bar())
Exception in thread "main" java.lang.NoSuchMethodError: test.Test$1.ajc$test_Per
typewithinTest$localAspectOf()Ltest/PertypewithinTest;
at test.Test$1.run(Test.java)
at test.Test.bar(Test.java:9)
at test.Test.main(Test.java:13)