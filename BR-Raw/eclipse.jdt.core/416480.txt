Bug 416480 – Error in bytecode generated by ECJ compiler leads to IncompatibleClassChangeError
Created attachment 235123 [details]
SneakyCaster.java
To reproduce, compile (and then run) the attached SneakyCaster.java using both javac and ECJ.
ECJ misses the checkcast instruction at the end of the cast() method.
This allows assignment of an Object to a Runnable variable.
Eventually, the JVM throws an IncompatibleClassChangeError, but clearly, as there is only one .class file, that's not right.
javac correctly includes the checkcast instruction, and a ClassCastException is thrown before the invalid assignment could ever be made.